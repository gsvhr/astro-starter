---
import Layout from '../../components/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	const blogPosts = await getCollection('blog');
	return blogPosts.map((post: any) => ({
		params: { slug: post.slug }
	}));
}

const { slug } = Astro.params;

// Получить все статьи
const allBlogPosts = await getCollection('blog');

// Найти статью по slug
const post = allBlogPosts.find((p: any) => p.slug === slug);

if (!post) {
	throw new Error(`Статья с slug '${slug}' не найдена`);
}

const { Content } = await post.render();
---

<Layout>
	<main class="py-16">
		<div class="container mx-auto px-4">
			<article class="max-w-3xl mx-auto">
				<h1 class="text-3xl font-bold mb-4">{post.data.title}</h1>
				<p class="text-gray-600 mb-8">{post.data.date}</p>
				<div class="prose prose-lg max-w-none">
					<Content />
				</div>
				<div class="mt-12">
					<a href="/contacts" class="inline-block bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 transition-colors">
						Заказать консультацию
					</a>
				</div>
			</article>
		</div>
	</main>
</Layout>